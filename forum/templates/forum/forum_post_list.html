{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Community Forum{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="display-5">Community Forum</h1>
        <hr>
        <p>Welcome to the REELtalk Community Forum! This is a place where movie enthusiasts can come together to discuss
            their favorite films, share reviews, and engage in meaningful conversations. Whether you're a casual viewer
            or a hardcore cinephile, you'll find a welcoming community here.</p>
        <br>
        <p>Here are a few things you can do in our forum:</p>
        <ul>
            <li><strong>Start a Discussion:</strong> Have something valuable to say? Start a new thread and get the
                conversation
                going.</li>
            <li><strong>Share Reviews:</strong> Watched a movie recently? Share your thoughts and reviews with the
                community.</li>
            <li><strong>Comment on Posts:</strong> Join existing discussions by commenting on posts. Your insights and
                opinions are valuable!</li>
            <li><strong>Upvote and Downvote:</strong> Show your appreciation for great posts by upvoting them, or
                downvote posts that you think are not helpful.</li>
        </ul>
        <br>
        <p><strong>Please remember</strong> to be respectful and follow our community guidelines. Let's keep the
            discussions friendly and
            enjoyable for everyone. Happy posting!</p>
        <hr>

        <!-- Search bar for Movie model -->
        <h2>Search for Movies</h2>
        <form method="get">
            <div class="input-group mb-3">
                <input type="text" name="search" class="form-control" placeholder="Search for movies...">
                <button class="btn submit" type="submit">Search</button>
            </div>
        </form>

        <!-- Movie Search Results -->
    {% if page_obj %}
    <h3>Search Results</h3>
    <div class="row mb-4">
        {% for movie in page_obj %}
        <div class="col-md-3 mb-3">
            <div class="card">
                <a href="{% url 'movie_detail' movie.tmdb_id %}">
                    <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" class="card-img-top" alt="{{ movie.title }}">
                </a>
                <div class="card-body">
                    <h5 class="card-title">{{ movie.title }}</h5>
                    <p class="card-text">Release Date: {{ movie.release_date }}</p>
                    <a href="{% url 'movie_detail' movie.tmdb_id %}" class="btn submit">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
        <!-- Display Movie search results -->
        <!-- {% if tmdb_results %}
        <h3>Search Results</h3>
        <div class="row">
            {% for result in tmdb_results %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <a href="{% url 'movie_detail' result.id %}">
                        <img src="https://image.tmdb.org/t/p/w500{{ result.poster_path }}" class="card-img-top"
                            alt="{{ result.title }}">
                    </a>
                    <div class="card-body">
                        <h5 class="card-title">{{ result.title }}</h5>
                        <p class="card-text">Release Date: {{ result.release_date }}</p>
                        <a href="{% url 'movie_detail' result.id %}" class="btn submit">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %} -->

        <table id="forum-posts-table" class="table table-striped">
            <tbody>
                {% for post in page_obj %}
                <tr>
                    <td class="col-2">
                        <img src="https://image.tmdb.org/t/p/w500{{ post.movie.poster_path }}"
                            alt="{{ post.movie.title }} Poster" class="img-fluid movie-poster">
                    </td>
                    <td class="col-2">By: <strong>{{ post.author.username }}</strong></td>
                    <td class="col-3">{{ post.title|truncatewords:15 }}</td>
                    <td class="col-3">{{ post.content|truncatewords:15 }}</td>
                    <td class="col-1"><i class="fa-solid fa-comments"></i> {{ post.comment_count }}</td>
                    <td class="col-1"><a href="{% url 'forum_post_detail' post.id %}" class="read_more">Read More</a></td>
                    <td class="col-1 text-center">
                        {% if user.is_authenticated %}
                        <a href="{% url 'upvote_post' post.id %}" class="btn btn-link">
                            <i class="fa fa-thumbs-up"></i> {{ post.upvotes.count }}
                        </a>
                        <a href="{% url 'downvote_post' post.id %}" class="btn btn-link">
                            <i class="fa fa-thumbs-down"></i> {{ post.downvotes.count }}
                        </a>
                        {% else %}
                        <span>{{ post.upvotes.count }} <i class="fa fa-thumbs-up"></i></span>
                        <span>{{ post.downvotes.count }} <i class="fa fa-thumbs-down"></i></span>
                        {% endif %}
                    </td>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
</div>
</div>
{% if is_paginated %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li><a href="?page={{ page_obj.previous_page_number }}" class="page-link">&laquo; PREV </a></li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% elif num > page_obj.number|add:'-6' and num < page_obj.number|add:'6' %} <li class="page-item"><a
                href="?page={{ num }}" class="page-link">{{ num }}</a></li>
            {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
            <li class="page-item"><a href="?page={{ page_obj.next_page_number }}" class="page-link">NEXT &raquo;</a>
            </li>
            {% endif %}
    </ul>
</nav>
{% endif %}
</div>

{% endblock %}