{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Community Forum{% endblock %}

{% block content %} 

<div class="container  mt-4">
    <h1 class="display-5">Community Forum</h1>
    <hr>
    <p>Welcome to the REELtalk Community Forum! This is a place where movie enthusiasts can come together to discuss
            favorite films, share reviews, and engage in meaningful conversations. So, whether you're a casual viewer
            or a hardcore cinephile, you'll find a welcoming community here.</p>
    <br>
    <p>Here are a few things you can do in our forum:</p>
    <ul>
        <li><strong>Start a Discussion:</strong> Have something valuable to say? Start a new thread and get the
                conversation
                going.</li>
        <li><strong>Share Reviews:</strong> Watched a movie recently? Share your thoughts and reviews with the
                community.</li>
        <li><strong>Comment on Posts:</strong> Join existing discussions by commenting on posts. Your insights and
                opinions are valuable!</li>
        <li><strong>Upvote and Downvote:</strong> Show your appreciation for great posts by upvoting them, or
                downvote posts that you think are not helpful.</li>
    </ul>
    <br>
    <p><strong>Please remember</strong> to be respectful and follow our community guidelines. Let's keep the
            discussions friendly and
            enjoyable for everyone. Happy posting!</p>
    <hr>
    <div class="table-responsive">
        <table id="forum-posts-table" class="table table-striped">
            <tbody>
                {% for post in page_obj %}
                <tr>
                    <td class="col-2">
                        <img src="https://image.tmdb.org/t/p/w500{{ post.movie.poster_path }}"
                            alt="{{ post.movie.title }} Poster" class="forum-img-fluid movie-poster">
                    </td>
                    <td class="col-2">By: <strong>{{ post.author.username }}</strong></td>
                    <td class="col-2">{{ post.title|truncatewords:15 }}</td>
                    <td class="col-3">{{ post.content|truncatewords:15 }}</td>
                    <td class="col-1"><i class="fa-solid fa-comments"></i> {{ comment_count }}</td>
                    <td class="col-1"><a href="{% url 'forum_post_detail' post.movie.slug post.slug %}" class="read_more">Read More</a></td>
                    <td class="col-2 text-center">
                        {% if user.is_authenticated %}
                        <a href="{% url 'upvote_post' post.id %}" class="btn btn-link">
                            <i class="fa fa-thumbs-up"></i> {{ post.upvotes.count }}
                        </a>
                        <a href="{% url 'downvote_post' post.id %}" class="btn btn-link">
                            <i class="fa fa-thumbs-down"></i> {{ post.downvotes.count }}
                        </a>
                        {% else %}
                        <span>{{ post.upvotes.count }} <i class="fa fa-thumbs-up"></i></span>
                        <span>{{ post.downvotes.count }} <i class="fa fa-thumbs-down"></i></span>
                        <div class="comment-actions">
                            <button type="button" class="btn btn-edit btn-sm btn-warning mx-2"
                                comment_id="{{ comment.id }}">Edit</button>
                            <button type="button" class="btn btn-delete btn-sm btn-danger"
                                comment_id="{{ comment.id }}" data-bs-toggle="modal"
                                data-bs-target="#deleteModal">Delete</button>
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{% if is_paginated %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li><a href="?page={{ page_obj.previous_page_number }}" class="page-link">&laquo; PREV </a></li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% elif num > page_obj.number|add:'-6' and num < page_obj.number|add:'6' %} <li class="page-item"><a
                href="?page={{ num }}" class="page-link">{{ num }}</a></li>
            {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
            <li class="page-item"><a href="?page={{ page_obj.next_page_number }}" class="page-link">NEXT &raquo;</a>
            </li>
            {% endif %}
        </ul>
    </nav>
{% endif %}

<hr>
{% if user.is_authenticated %}
<h4 class="mt-2">Post a Comment</h4>
<form id="commentForm" method="post">
    {% csrf_token %}
    {{ comment_form|crispy }}
    <button type="submit" id="submitButton" class="btn submit btn-primary">Submit</button>
</form>
{% endif %}
</div>
{% endblock %}
