{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load custom_filters %}
{% load static %}

{% block title %}{{ movie.title }}{% endblock %}

{% block content %}

<div class="container mt-4">
    <a href="{% url 'forum_post_list' %}" class="btn submit my-1">
        Looking for Community chat? Click here <i class="fa fa-arrow-right"></i>
    </a>
    <hr>
    <h1 class="display-5 mt-1"><strong>Your Chosen Movie Details:</strong></h1>
    <hr>
    <div class="row">
        <div class="my-4">
            <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" class="img-fluid" alt="{{ movie.title }}">
        </div>
        <div class="col-md-12">
            <h1><strong>{{ movie.title }}</strong></h1>
            <p><strong>Release Date:</strong> {{ movie.release_date }}</p>
            <p><strong>Overview:</strong> {{ movie.overview }}</p>
            <p><strong>Popularity:</strong> {{ movie.popularity }}</p>
            <p><strong>Vote Count:</strong> {{ movie.vote_count }}</p>
            <p><strong>Vote Average:</strong> {{ movie.vote_average }}</p>
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 mt-2">
            {% if not user.is_authenticated %}
            <p class="text-center">If you would like to write a review or your thoughts about this movie then <a
                    class="link" href="{% url 'account_signup' %}">sign up</a> or <a class="link"
                    href="{% url 'account_login' %}">login here</a></p>
            {% endif %}
            {% if user.is_authenticated %}
            <p class="my-2"><strong>Why not write a review or just share some thoughts about this movie and start a
                    discussion?:</strong></p>
            <form id="ForumPostForm" class="mt-3" method="post">
                {% csrf_token %}
                {{ post_form|crispy }}
                <button type="submit" id="submitButton" class="btn submit mb-5">Submit</button>
            </form>
            <hr>
            <h2>Your Posts</h2>
            {% if user_posts %}
            {% for post in user_posts %}
            <div class="card mb-5">
                <div class="card-body">
                    <h5 class="card-title">{{ post.title }} - {{ post.created_at|timesince_hours }}</h5>
                    <p class="card-text">{{ post.content }}</p>
                    <!-- <a href="{% url 'forum_post_detail' post.movie.slug post.slug %}" class="btn submit">View Post</a> -->
                    <button class="btn btn-warning" onclick="showEditForm('{{ post.id }}')">Edit</button>
                    <a href="{% url 'delete_post' post.id %}" class="btn btn-danger">Delete</a>
                </div>
            </div>
            <div id="editForm-{{ post.id }}" class="edit-form" style="display: none;">
                <form method="post" action="{% url 'edit_post' post.id %}">
                    {% csrf_token %}
                    {{ post_form|crispy }}
                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>
            {% endfor %}
            {% else %}
            <p>You have not posted any reviews yet.</p>
            {% endif %}
            {% else %}
            <p><a href="{% url 'account_login' %}">Log in</a> to post a review.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

